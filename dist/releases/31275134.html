<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BALTHVS — Harvest</title>
  <style>
    :root {
      --bg: #0b0b0c;
      --card: #16171a;
      --text: #e7e7ea;
      --muted: #a0a3aa;
      --accent: #67e8f9;
      --border: #2a2b2f;
      --header-bg: rgba(11, 11, 12, 0.8);
    }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif;
    }
    .wrap {
      max-width: 1240px;
      margin: 0 auto;
      padding: 0 20px;
    }
    .content-wrap {
      margin-top: 24px;
      margin-bottom: 24px;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .muted { color: var(--muted); }

    /* Layout Helpers */
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .gap-4 { gap: 16px; }
    .gap-2 { gap: 8px; }

    /* Common Components */
    .btn-small {
      font-size: .8rem;
      padding: 4px 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--text);
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn-small:hover { border-color: var(--accent); text-decoration: none; }

    /* Common Header Components */
    .main-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--header-bg);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
    }
    .header-content {
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text);
      text-decoration: none;
    }

    /* Desktop Nav */
    .desktop-nav { display: flex; align-items: center; gap: 20px; }
    @media (max-width: 768px) { .desktop-nav { display: none; } }

    /* Account Dropdown */
    .dropdown { position: relative; display: inline-block; }
    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      top: 100%;
      background: var(--card);
      min-width: 160px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.4);
      border-radius: 8px;
      border: 1px solid var(--border);
      padding: 8px 0;
      z-index: 101;
    }
    .dropdown:hover .dropdown-content { display: block; }
    .dropdown-item {
      display: block;
      padding: 8px 16px;
      color: var(--text);
      text-decoration: none;
    }
    .dropdown-item:hover { background: rgba(255,255,255,0.05); }

    /* Mobile Nav / Hamburger */
    .mobile-nav-toggle {
      display: none;
      background: transparent;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 8px;
    }
    @media (max-width: 768px) { .mobile-nav-toggle { display: block; } }

    .mobile-menu {
      display: none;
      position: fixed;
      top: 65px;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg);
      z-index: 99;
      padding: 20px;
      flex-direction: column;
      gap: 12px;
    }
    .mobile-menu.active { display: flex; }
    .mobile-menu .nav-item {
        display: block;
        padding: 12px 16px;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 10px;
        color: var(--text);
        text-decoration: none;
        font-weight: 500;
    }
    .mobile-menu .nav-item:hover { border-color: var(--accent); }

    /* Breadcrumbs */
    .breadcrumbs {
      padding: 12px 0;
      font-size: 0.9rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .breadcrumbs a { color: var(--muted); }
    .breadcrumbs span { margin: 0 8px; opacity: 0.5; }

    /* Utility Bar (Mobile Sticky Search/Sort) */
    .utility-bar {
        display: none;
        position: sticky;
        top: 65px;
        z-index: 90;
        background: var(--bg);
        padding: 8px 20px;
        border-bottom: 1px solid var(--border);
    }
    @media (max-width: 768px) {
        .utility-bar.is-visible { display: block; }
    }
  </style>
    <style>
    :root { --overlay: rgba(0,0,0,.9); }
    .layout{display:grid;grid-template-columns:1fr 1fr;gap:40px}
    .card{background:var(--card);border-radius:12px;overflow:hidden}
    .cover{width:100%;aspect-ratio:1/1;object-fit:cover;background:#222;cursor:zoom-in}
    .meta{padding:16px}
    h1{margin:0 0 8px 0;font-size:2rem}

    /* Carousel */
    .carousel-container { position: relative; width: 100%; overflow: hidden; border-radius: 12px; }
    .carousel-track { display: flex; transition: transform 0.3s ease-out; }
    .carousel-slide { min-width: 100%; aspect-ratio: 1/1; }
    .carousel-slide img { width: 100%; height: 100%; object-fit: cover; }
    .carousel-dots { display: none; justify-content: center; gap: 8px; margin-top: 12px; }
    .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--muted); cursor: pointer; opacity: 0.5; }
    .dot.active { background: var(--accent); opacity: 1; }

    /* Tabs */
    .tabs { display: flex; gap: 4px; border-bottom: 1px solid #2a2b2f; margin-top: 24px; overflow-x: auto; scrollbar-width: none; }
    .tabs::-webkit-scrollbar { display: none; }
    .tab { padding: 12px 20px; cursor: pointer; color: var(--muted); border-bottom: 2px solid transparent; white-space: nowrap; }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
    .tab-content { display: none; padding-top: 20px; }
    .tab-content.active { display: block; }

    /* Skeleton Loader */
    @keyframes skeleton-loading {
      0% { opacity: 1; }
      50% { opacity: 0.4; }
      100% { opacity: 1; }
    }
    .skeleton-loader div {
      animation: skeleton-loading 1.5s infinite ease-in-out;
    }

    /* Lightbox */
    .lightbox{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:var(--overlay);z-index:1000}
    .lightbox.open{display:flex}
    .lb-inner{position:relative;max-width:95vw;max-height:95vh;display:flex;align-items:center;justify-content:center}
    .lb-img{max-width:95vw;max-height:95vh;object-fit:contain;box-shadow:0 10px 30px rgba(0,0,0,.6)}
    .lb-close{position:absolute;top:12px;right:12px;background:rgba(0,0,0,.6);color:#fff;border:0;border-radius:999px;width:40px;height:40px;cursor:pointer;font-size:20px}
    .lb-nav{position:absolute;top:50%;transform:translateY(-50%);display:flex;align-items:center;justify-content:center}
    .lb-prev,.lb-next{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.6);color:#fff;border:0;border-radius:999px;width:44px;height:44px;cursor:pointer;font-size:20px}
    .lb-prev{left:-60px}
    .lb-next{right:-60px}
    .lb-counter{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);color:#fff;background:rgba(0,0,0,.5);padding:4px 10px;border-radius:999px;font-size:.9rem}

    @media (max-width: 800px){
      .layout{grid-template-columns:1fr; gap: 24px;}
      .carousel-dots { display: flex; }
      .lb-prev{left:10px}
      .lb-next{right:10px}
      .wrap { margin-top: 12px; }
    }
  </style>
</head>
<body>
  <header class="main-header">
    <div class="wrap">
      <div class="header-content">
        <a href="../index.html" class="logo">My Music</a>

        <div class="desktop-nav">
          <a href="../index.html" class="muted">Collection</a>
          <a href="../wantlist.html" class="muted">Wantlist</a>
          <a href="javascript:void(0)" class="muted" onclick="if(window.surpriseMe)window.surpriseMe();">Surprise Me</a>
          <a href="../stats.html" class="muted">Stats</a>
          <a href="../about.html" class="muted">About</a>
        </div>

        <button class="mobile-nav-toggle" id="mobile-toggle" aria-label="Toggle menu">☰</button>
      </div>
    </div>
  </header>

  <div class="mobile-menu" id="mobile-menu">
    <a href="../index.html" class="nav-item">Collection</a>
    <a href="../wantlist.html" class="nav-item">Wantlist</a>
    <a href="javascript:void(0)" class="nav-item" onclick="if(window.surpriseMe)window.surpriseMe();">Surprise Me</a>
    <a href="../stats.html" class="nav-item">Stats</a>
    <a href="../about.html" class="nav-item">About</a>
  </div>

  <div class="wrap">
      <nav class="breadcrumbs">
    <div>
      <a href="../index.html">Home</a>
      <span>/</span>
      <a href="../index.html">Collection</a>
      <span>/</span>
      Harvest
    </div>
  </nav>
  </div>

  
    <div class="wrap content-wrap">
    <div style="margin-bottom:24px">
      <p style="margin:0"><a href="../index.html" style="background:var(--card);border:1px solid #2a2b2f;padding:6px 12px;border-radius:8px;color:var(--text);font-size:.9rem;text-decoration:none">← Back</a></p>
    </div>
                <div class="layout">
        <div>
          <div class="carousel-container" id="carousel">
            <div class="carousel-track" id="carousel-track">
                                                <div class="carousel-slide">
                    <img class="cover" src="../images/31275134/9d9be930ff1c29938e4c9d01a4fb827aead372e4.jpg" alt="Harvest cover" data-idx="0" />
                  </div>
                                  <div class="carousel-slide">
                    <img class="cover" src="../images/31275134/1670d9f84e8cbd47d2d19978de0449fd97e273d2.jpg" alt="Harvest cover" data-idx="1" />
                  </div>
                                  <div class="carousel-slide">
                    <img class="cover" src="../images/31275134/470830f4f2d229a18880728437acf1abec060d77.jpg" alt="Harvest cover" data-idx="2" />
                  </div>
                                  <div class="carousel-slide">
                    <img class="cover" src="../images/31275134/544554a2062802c2c8e394a5b86e71b07802ddf6.jpg" alt="Harvest cover" data-idx="3" />
                  </div>
                                  <div class="carousel-slide">
                    <img class="cover" src="../images/31275134/7e54555d2de176838b032c16160700125535d6fe.jpg" alt="Harvest cover" data-idx="4" />
                  </div>
                                  <div class="carousel-slide">
                    <img class="cover" src="../images/31275134/18339a3a46ff8560d61961df7b55127d7ef3778f.jpg" alt="Harvest cover" data-idx="5" />
                  </div>
                                  <div class="carousel-slide">
                    <img class="cover" src="../images/31275134/1e6d2497e19ad8fe5850266013267b5550a1dc6b.jpg" alt="Harvest cover" data-idx="6" />
                  </div>
                                          </div>
          </div>
                      <div class="carousel-dots" id="carousel-dots">
                              <div class="dot active" data-idx="0"></div>
                              <div class="dot " data-idx="1"></div>
                              <div class="dot " data-idx="2"></div>
                              <div class="dot " data-idx="3"></div>
                              <div class="dot " data-idx="4"></div>
                              <div class="dot " data-idx="5"></div>
                              <div class="dot " data-idx="6"></div>
                          </div>
            <div class="thumbs" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:16px;">
                              <button class="thumb" data-idx="0" style="border:0;background:transparent;padding:0;cursor:pointer">
                  <img src="../images/31275134/9d9be930ff1c29938e4c9d01a4fb827aead372e4.jpg" alt="thumb 1" style="width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid #2a2b2f;opacity:1" />
                </button>
                              <button class="thumb" data-idx="1" style="border:0;background:transparent;padding:0;cursor:pointer">
                  <img src="../images/31275134/1670d9f84e8cbd47d2d19978de0449fd97e273d2.jpg" alt="thumb 2" style="width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid #2a2b2f;opacity:.7" />
                </button>
                              <button class="thumb" data-idx="2" style="border:0;background:transparent;padding:0;cursor:pointer">
                  <img src="../images/31275134/470830f4f2d229a18880728437acf1abec060d77.jpg" alt="thumb 3" style="width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid #2a2b2f;opacity:.7" />
                </button>
                              <button class="thumb" data-idx="3" style="border:0;background:transparent;padding:0;cursor:pointer">
                  <img src="../images/31275134/544554a2062802c2c8e394a5b86e71b07802ddf6.jpg" alt="thumb 4" style="width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid #2a2b2f;opacity:.7" />
                </button>
                              <button class="thumb" data-idx="4" style="border:0;background:transparent;padding:0;cursor:pointer">
                  <img src="../images/31275134/7e54555d2de176838b032c16160700125535d6fe.jpg" alt="thumb 5" style="width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid #2a2b2f;opacity:.7" />
                </button>
                              <button class="thumb" data-idx="5" style="border:0;background:transparent;padding:0;cursor:pointer">
                  <img src="../images/31275134/18339a3a46ff8560d61961df7b55127d7ef3778f.jpg" alt="thumb 6" style="width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid #2a2b2f;opacity:.7" />
                </button>
                              <button class="thumb" data-idx="6" style="border:0;background:transparent;padding:0;cursor:pointer">
                  <img src="../images/31275134/1e6d2497e19ad8fe5850266013267b5550a1dc6b.jpg" alt="thumb 7" style="width:60px;height:60px;object-fit:cover;border-radius:8px;border:1px solid #2a2b2f;opacity:.7" />
                </button>
                          </div>
                  </div>
        <div>
          <h1>Harvest</h1>
          <p class="muted" style="font-size:1.2rem">BALTHVS • 2024</p>
          <p class="muted">US</p>
          <div style="margin:16px 0; display:flex; gap:8px; flex-wrap:wrap">
            <span class="muted" style="border:1px solid #2a2b2f;border-radius:12px;padding:4px 12px;font-size:.9rem">Latin</span><span class="muted" style="border:1px solid #2a2b2f;border-radius:12px;padding:4px 12px;font-size:.9rem">Funk / Soul</span>            <span class="muted" style="border:1px solid #2a2b2f;border-radius:12px;padding:4px 12px;font-size:.9rem">Psychedelic</span><span class="muted" style="border:1px solid #2a2b2f;border-radius:12px;padding:4px 12px;font-size:.9rem">Afrobeat</span><span class="muted" style="border:1px solid #2a2b2f;border-radius:12px;padding:4px 12px;font-size:.9rem">Disco</span>          </div>

                      <p class="muted">Labels:
              Mixto Records (L-MR444)            </p>
          
          <div class="tabs" id="release-tabs">
            <div class="tab active" data-tab="tracks">Tracks</div>
            <div class="tab" data-tab="details">Details</div>
            <div class="tab" data-tab="credits">Credits</div>
            <div class="tab" data-tab="status">Status & Notes</div>
                      </div>

          <div id="tab-tracks" class="tab-content active">
                          <div class="card">
                <div class="meta">
                  <ol style="margin:0; padding-left:20px">
                                          <li style="margin-bottom:8px">A1 — Sun Colored Eyes</li>
                                          <li style="margin-bottom:8px">A2 — Asha</li>
                                          <li style="margin-bottom:8px">A3 — Anouk</li>
                                          <li style="margin-bottom:8px">A4 — Like Coconut Water</li>
                                          <li style="margin-bottom:8px">A5 — Lovin</li>
                                          <li style="margin-bottom:8px">B1 — Aquacero</li>
                                          <li style="margin-bottom:8px">B2 — Mango Season</li>
                                          <li style="margin-bottom:8px">B3 — Sun &amp; Moon</li>
                                          <li style="margin-bottom:8px">B4 — Venus Flytrap</li>
                                          <li style="margin-bottom:8px">B5 — AIO</li>
                                      </ol>
                </div>
              </div>
            
            <div id="apple-music-player-container" style="margin-top:24px; display:none;">
              <div id="apple-music-player"></div>
            </div>
          </div>

          <div id="tab-details" class="tab-content">
            <div class="card">
                <div class="meta">
                                            <p class="muted"><strong>Formats:</strong>
                                                    Vinyl (Copper Nugget Variant)                                                </p>
                                        
                    
                    
                                    </div>
            </div>
          </div>

          <div id="tab-credits" class="tab-content">
                             <p class="muted">No credit information available.</p>
                       </div>

          <div id="tab-status" class="tab-content">
            <div class="card">
                <div class="meta">
                    <div style="margin-bottom:16px">
                        <strong>Discogs Status</strong>
                        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
                                                        <form method="post" action="/release/save" style="margin:0">
                                <input type="hidden" name="_token" value="" />
                                <input type="hidden" name="release_id" value="31275134" />
                                <input type="hidden" name="action" value="want_to_collection" />
                                <input type="hidden" name="return" value="../index.html" />
                                <button type="submit" style="background:var(--card);color:var(--accent);border:1px solid #2a2b2f;border-radius:8px;padding:6px 10px;cursor:pointer">Add to Collection</button>
                            </form>
                            
                                                        <form method="post" action="/release/save" style="margin:0">
                                <input type="hidden" name="_token" value="" />
                                <input type="hidden" name="release_id" value="31275134" />
                                <input type="hidden" name="action" value="add_want" />
                                <input type="hidden" name="return" value="../index.html" />
                                <button type="submit" class="muted" style="background:transparent;border:1px solid #2a2b2f;border-radius:8px;padding:6px 10px;cursor:pointer;color:inherit">Add to Wantlist</button>
                            </form>
                                                    </div>
                    </div>

                    <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
                        <strong>My Notes</strong>
                                            </div>

                    <div id="notesView" style="margin-top:8px">
                                                                                                                    </div>
                                                         </div>
            </div>
          </div>

                  </div>
      </div>

            <!-- Lightbox overlay -->
      <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog">
        <div class="lb-inner">
          <button class="lb-close" aria-label="Close">✕</button>
          <button class="lb-prev" aria-label="Previous">◀</button>
          <img class="lb-img" src="" alt="Full-size image" />
          <button class="lb-next" aria-label="Next">▶</button>
          <div class="lb-counter">1 / 7</div>
        </div>
      </div>

      <script>
        document.addEventListener('DOMContentLoaded', function(){
          const images = [
            '..\/images\/31275134\/9d9be930ff1c29938e4c9d01a4fb827aead372e4.jpg', '..\/images\/31275134\/1670d9f84e8cbd47d2d19978de0449fd97e273d2.jpg', '..\/images\/31275134\/470830f4f2d229a18880728437acf1abec060d77.jpg', '..\/images\/31275134\/544554a2062802c2c8e394a5b86e71b07802ddf6.jpg', '..\/images\/31275134\/7e54555d2de176838b032c16160700125535d6fe.jpg', '..\/images\/31275134\/18339a3a46ff8560d61961df7b55127d7ef3778f.jpg', '..\/images\/31275134\/1e6d2497e19ad8fe5850266013267b5550a1dc6b.jpg'          ];
          const track = document.getElementById('carousel-track');
          const dots = document.querySelectorAll('.dot');
          const thumbs = document.querySelectorAll('.thumb');
          const lb = document.getElementById('lightbox');
          const lbImg = lb ? lb.querySelector('.lb-img') : null;
          const lbClose = lb ? lb.querySelector('.lb-close') : null;
          const lbPrev = lb ? lb.querySelector('.lb-prev') : null;
          const lbNext = lb ? lb.querySelector('.lb-next') : null;
          const lbCounter = lb ? lb.querySelector('.lb-counter') : null;
          let idx = 0;

          function updateCarousel(to){
            idx = Math.max(0, Math.min(images.length - 1, to));
            if (track) track.style.transform = `translateX(-${idx * 100}%)`;
            dots.forEach((d, i) => d.classList.toggle('active', i === idx));
          }

          function openLightbox(startIdx){
            if (!lb || !lbImg) return;
            idx = Math.max(0, Math.min(images.length - 1, startIdx));
            lbImg.src = images[idx];
            if (lbCounter) lbCounter.textContent = (idx + 1) + ' / ' + images.length;
            lb.classList.add('open');
            lb.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
          }
          function closeLightbox(){
            if (!lb) return;
            lb.classList.remove('open');
            lb.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
          }
          function next(){ idx = (idx + 1) % images.length; if (lb.classList.contains('open')) { lbImg.src = images[idx]; lbCounter.textContent = (idx + 1) + ' / ' + images.length; } else { updateCarousel(idx); } }
          function prev(){ idx = (idx - 1 + images.length) % images.length; if (lb.classList.contains('open')) { lbImg.src = images[idx]; lbCounter.textContent = (idx + 1) + ' / ' + images.length; } else { updateCarousel(idx); } }

          // Carousel dot/thumb clicks
          dots.forEach(d => d.addEventListener('click', () => updateCarousel(parseInt(d.dataset.idx))));
          thumbs.forEach(t => t.addEventListener('click', () => updateCarousel(parseInt(t.dataset.idx))));

          // Lightbox trigger on carousel image click
          document.querySelectorAll('.carousel-slide img').forEach(img => {
            img.addEventListener('click', () => openLightbox(parseInt(img.dataset.idx)));
          });

          // Lightbox interactions
          lbClose?.addEventListener('click', closeLightbox);
          lbPrev?.addEventListener('click', prev);
          lbNext?.addEventListener('click', next);
          lbImg?.addEventListener('click', next);
          lb?.addEventListener('click', function(e){ if (e.target === lb) closeLightbox(); });

          // Keyboard
          document.addEventListener('keydown', function(e){
            if (!lb || !lb.classList.contains('open')) return;
            if (e.key === 'Escape') closeLightbox();
            else if (e.key === 'ArrowRight') next();
            else if (e.key === 'ArrowLeft') prev();
          });

          // Tabs
          const tabs = document.querySelectorAll('.tab');
          const contents = document.querySelectorAll('.tab-content');
          tabs.forEach(t => {
            t.addEventListener('click', () => {
              const target = t.dataset.tab;
              tabs.forEach(t2 => t2.classList.toggle('active', t2 === t));
              contents.forEach(c => c.classList.toggle('active', c.id === `tab-${target}`));

              if (target === 'recommendations' && !t.dataset.loaded) {
                fetchRecommendations();
                t.dataset.loaded = 'true';
              }
            });
          });

          async function fetchRecommendations() {
            const container = document.getElementById('recommendations-container');
            try {
              const res = await fetch(`/release/31275134/recommendations`);
              const data = await res.json();
              
              if (data.error) {
                container.innerHTML = `<p class="muted">${data.error}</p>`;
                return;
              }

              if (data.recommendations && data.recommendations.length > 0) {
                let html = '<ul style="margin:0; padding-left:20px">';
                data.recommendations.forEach(item => {
                  const label = item.type === 'release' ? `${item.artist} — ${item.title}` : item.artist;
                  const searchUrl = `/?q=${encodeURIComponent('discogs: ' + (item.type === 'artist' ? 'artist:' : '') + item.artist + (item.type === 'release' ? ' title:"' + item.title + '"' : ''))}`;
                  
                  html += `<li style="margin-bottom:12px">
                    <div style="display:flex; justify-content:space-between; align-items:center; gap:8px">
                      <span><strong>${label}</strong> <span class="muted">(${item.type})</span></span>
                      <div style="display:flex; gap:8px">
                        <a href="${searchUrl}" class="muted" style="font-size:0.8rem; border:1px solid #2a2b2f; padding:2px 8px; border-radius:4px; text-decoration:none; color:var(--accent)">Live Search</a>
                      </div>
                    </div>
                  </li>`;
                });
                html += '</ul>';
                container.innerHTML = html;
              } else {
                container.innerHTML = '<p class="muted">No recommendations found.</p>';
              }
            } catch (e) {
              container.innerHTML = '<p class="muted">Error loading recommendations.</p>';
            }
          }

          // Handle tab parameter in URL
          const urlParams = new URLSearchParams(window.location.search);
          const activeTab = urlParams.get('tab');
          if (activeTab) {
            const tabEl = document.querySelector(`.tab[data-tab="${activeTab}"]`);
            if (tabEl) tabEl.click();
          }

          // Swipe support for carousel (basic)
          let startX = 0;
          track?.addEventListener('touchstart', e => startX = e.touches[0].clientX);
          track?.addEventListener('touchend', e => {
            const diff = startX - e.changedTouches[0].clientX;
            if (Math.abs(diff) > 50) {
              if (diff > 0) next(); else prev();
            }
          });

          // Notes Toggle
          (function(){
            const btn = document.getElementById('editToggle');
            const form = document.getElementById('notesForm');
            const view = document.getElementById('notesView');
            if (!btn || !form || !view) return;
            btn.addEventListener('click', function(){
                const open = form.style.display === 'none';
                form.style.display = open ? 'flex' : 'none';
                view.style.display = open ? 'none' : 'block';
                btn.textContent = open ? 'Cancel' : 'Edit';
                if (open) {
                    // Switch to status tab if not active
                    document.querySelector('.tab[data-tab="status"]').click();
                }
            });
          })();

          // Apple Music Player
          (async function loadAppleMusicPlayer() {
              const container = document.getElementById('apple-music-player-container');
              const player = document.getElementById('apple-music-player');
              if (!container || !player) return;

              try {
                  const res = await fetch(`/release/31275134/apple-music-id`);
                  const data = await res.json();

                  if (data.apple_music_id) {
                      container.style.display = 'block';
                      player.innerHTML = `<iframe allow="autoplay *; encrypted-media *; fullscreen *; clipboard-write" frameborder="0" height="450" style="width:100%;max-width:660px;overflow:hidden;border-radius:10px;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/us/album/${data.apple_music_id}"></iframe>`;
                  }
              } catch (e) {
                  console.error('Failed to load Apple Music player:', e);
              }
          })();
        });
      </script>
            </div>

    <script>
    document.getElementById('mobile-toggle')?.addEventListener('click', function() {
      document.getElementById('mobile-menu').classList.toggle('active');
      this.textContent = document.getElementById('mobile-menu').classList.contains('active') ? '✕' : '☰';
    });
  </script>

  <footer class="site-footer muted" style="text-align:center;margin:24px 0 8px 0;font-size:.9rem;">
  Powered by Discogs API & Coffee Since 2026 | Lovingly Crafted in Boise, Idaho
</footer>
</body>
</html>
