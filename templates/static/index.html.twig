{% extends 'base.html.twig' %}

{% block title %}{{ title }}{% endblock %}

{% block styles %}
  <style>
    header{z-index:10;margin:0 0 24px 0;padding:0}
    .header-bottom{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
    h1{font-size:1.4rem;margin:0}
    .stats{font-size:.9rem}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px}
    .card{background:var(--card);border-radius:12px;overflow:hidden;text-decoration:none;display:block;color:inherit}
    .card:hover{text-decoration:none}
    .cover-wrap{aspect-ratio:1/1;width:100%;overflow:hidden;position:relative}
    .cover{width:100%;height:100%;object-fit:cover;background:#222}
    .cover.ready{animation:none}
    .meta{padding:12px}
    .title{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .artist{color:var(--muted);font-size:.9rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    
    /* Toolbar */
    .toolbar{display:flex;gap:8px;align-items:center;margin:0;flex-wrap:wrap;flex:1}
    .search-input{background:var(--card);color:var(--text);border:1px solid #2a2b2f;border-radius:10px;padding:8px 14px;width:100%;font-size:.95rem;height:40px;box-sizing:border-box}
    .search-input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 1px rgba(103,232,249,.2)}
    .search-submit{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--text);opacity:0.6;cursor:pointer;padding:4px;display:flex;align-items:center;transition:all .2s;z-index:2}
    .search-submit:hover{color:var(--accent);opacity:1;transform:translateY(-50%) scale(1.1)}
    .sort-wrap{display:flex;gap:8px;align-items:center}
    .sort-select{background:var(--card);color:var(--text);border:1px solid #2a2b2f;border-radius:10px;padding:8px 12px;font-size:.9rem;cursor:pointer}
    .sort-select:focus{outline:none;border-color:var(--accent)}

    /* Modern pagination */
    .pagination{display:flex;justify-content:center;align-items:center;gap:8px;flex-wrap:wrap;margin-top:28px}
    .page-btn{display:inline-flex;align-items:center;justify-content:center;min-width:40px;height:40px;padding:0 12px;border-radius:12px;border:1px solid #2a2b2f;background:var(--card);color:var(--text);text-decoration:none;font-weight:600}
    .page-btn:hover{background:#1d1f24;text-decoration:none}
    .page-btn.is-current{background:linear-gradient(135deg,#222631,#1a1d24);border-color:#3a3d44;box-shadow:0 0 0 1px rgba(103,232,249,.2) inset;color:#fff}
    .page-btn.is-disabled{opacity:.5;pointer-events:none}

    @media (max-width: 768px){
      .wrap{margin:12px auto}
      header{margin-bottom:16px}
      .header-bottom{flex-direction:column;align-items:stretch;gap:12px}
      .toolbar{width:100%;flex-direction:column;align-items:stretch}
      .search-input{width:100%}
      .sort-wrap{width:100%}
      .sort-select{width:100%}
      .pagination{position:sticky;bottom:calc(8px + env(safe-area-inset-bottom));background:rgba(11,11,12,.8);backdrop-filter:blur(8px);padding:8px 12px;border-radius:14px;border:1px solid #2a2b2f;z-index:80}
      .page-btn{min-width:64px;height:44px;font-size:1rem}
    }
  </style>
{% endblock %}

{% block breadcrumbs %}
  <nav class="breadcrumbs">
    <div>
      <a href="{{ static_export ? (base_url is same as('') ? (depth > 0 ? '../' : './') ~ 'index.html' : base_url) : '/' }}">Home</a>
      <span>/</span>
      {{ view|capitalize|default('Collection') }}
    </div>
    <div id="stats" class="muted" style="font-size: 0.85rem">
        {{ total|default(0) }} items
        {% if q is defined and q %} • Search: “{{ q }}”{% endif %}
    </div>
  </nav>
{% endblock %}

{% block header %}
  <div class="wrap">
    <header>
        <div class="header-bottom">
          <form id="search-form" class="toolbar" onsubmit="return false;">
            <div style="display:flex;gap:8px;width:100%">
              <div style="position:relative;flex:1">
                <input id="search-input" class="search-input" type="text" name="q" value="{{ q|default('')|e }}" placeholder="Search artist:miles year:1980..1989 barcode:…" style="padding-right:40px" />
                <button type="submit" class="search-submit" title="Search">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </button>
              </div>
            </div>
            <div class="sort-wrap">
              <select id="sort" class="sort-select" name="sort">
                <optgroup label="Sort by">
                  <option value="added_desc">Added (newest)</option>
                  <option value="added_asc">Added (oldest)</option>
                  <option value="rating_desc">Rating (high→low)</option>
                  <option value="rating_asc">Rating (low→high)</option>
                  <option value="year_desc">Year (newest)</option>
                  <option value="year_asc">Year (oldest)</option>
                  <option value="artist_asc">Artist (A→Z)</option>
                  <option value="artist_desc">Artist (Z→A)</option>
                  <option value="title_asc">Title (A→Z)</option>
                  <option value="title_desc">Title (Z→A)</option>
                </optgroup>
              </select>
            </div>
          </form>
        </div>
    </header>
  </div>
{% endblock %}

{% block content %}
  <div class="wrap content-wrap">
    <div id="grid" class="grid" aria-live="polite"></div>
    <nav id="pager" class="pagination" aria-label="Pagination"></nav>
  </div>
{% endblock %}

{% block scripts %}
  {# Inline JSON fallback for file:// viewing when fetch() is blocked. Only rendered when releases_json is provided. #}
  {% if releases_json is defined and releases_json %}
    <script id="releases-data" type="application/json">{{ releases_json|raw }}</script>
  {% endif %}
  <script src="{{ static_export ? (base_url is same as('') ? (depth > 0 ? '../' : './') ~ 'assets/app.js' : base_url ~ '/assets/app.js') : '/assets/app.js' }}" defer></script>
{% endblock %}
